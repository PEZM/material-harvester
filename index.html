<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#1e293b" />
  <title>Material Harvest</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="manifest" href="manifest.json" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body class="bg-slate-100">
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Database helper using IndexedDB for persistence
    const DB_NAME = 'MaterialHarvestDB';
    const STORE_NAME = 'items';

    const openDB = () => {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, 1);
        request.onerror = () => reject(request.error);
        request.onsuccess = () => resolve(request.result);
        request.onupgradeneeded = (e) => {
          const db = e.target.result;
          if (!db.objectStoreNames.contains(STORE_NAME)) {
            db.createObjectStore(STORE_NAME, { keyPath: 'id' });
          }
        };
      });
    };

    const saveItems = async (items) => {
      const db = await openDB();
      const tx = db.transaction(STORE_NAME, 'readwrite');
      const store = tx.objectStore(STORE_NAME);
      await store.clear();
      items.forEach(item => store.put(item));
      return tx.complete;
    };

    const loadItems = async () => {
      const db = await openDB();
      const tx = db.transaction(STORE_NAME, 'readonly');
      const store = tx.objectStore(STORE_NAME);
      return new Promise((resolve) => {
        const request = store.getAll();
        request.onsuccess = () => resolve(request.result || []);
        request.onerror = () => resolve([]);
      });
    };

    // Categories configuration
    const CATEGORIES = [
      { id: 'door', label: 'Doors', icon: 'üö™', color: 'bg-amber-500' },
      { id: 'window', label: 'Windows', icon: 'ü™ü', color: 'bg-sky-500' },
      { id: 'timber', label: 'Timber', icon: 'ü™µ', color: 'bg-orange-600' },
      { id: 'metal', label: 'Metal', icon: 'üî©', color: 'bg-zinc-500' },
      { id: 'brick', label: 'Brick/Stone', icon: 'üß±', color: 'bg-red-600' },
      { id: 'glass', label: 'Glass', icon: 'üî≤', color: 'bg-cyan-400' },
      { id: 'fixture', label: 'Fixtures', icon: 'üí°', color: 'bg-yellow-500' },
      { id: 'furniture', label: 'Furniture', icon: 'ü™ë', color: 'bg-emerald-600' },
      { id: 'other', label: 'Other', icon: 'üì¶', color: 'bg-purple-500' },
    ];

    const CONDITIONS = ['Excellent', 'Good', 'Fair', 'Salvageable'];

    // Icons as components
    const PlusIcon = () => (
      <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
      </svg>
    );

    const CameraIcon = () => (
      <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg>
    );

    const FilterIcon = () => (
      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
      </svg>
    );

    const SortIcon = () => (
      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
      </svg>
    );

    const SearchIcon = () => (
      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
    );

    const TrashIcon = () => (
      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
      </svg>
    );

    const CloseIcon = () => (
      <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
      </svg>
    );

    const ImageIcon = () => (
      <svg className="w-12 h-12 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
      </svg>
    );

    // Main App Component
    function App() {
      const [items, setItems] = useState([]);
      const [view, setView] = useState('list'); // 'list', 'add', 'detail'
      const [selectedItem, setSelectedItem] = useState(null);
      const [filter, setFilter] = useState('all');
      const [sortBy, setSortBy] = useState('date');
      const [sortOrder, setSortOrder] = useState('desc');
      const [searchQuery, setSearchQuery] = useState('');
      const [showFilterMenu, setShowFilterMenu] = useState(false);
      const [showSortMenu, setShowSortMenu] = useState(false);
      const [isLoading, setIsLoading] = useState(true);

      // Load items on mount
      useEffect(() => {
        loadItems().then(loaded => {
          setItems(loaded);
          setIsLoading(false);
        });
      }, []);

      // Save items when they change
      useEffect(() => {
        if (!isLoading) {
          saveItems(items);
        }
      }, [items, isLoading]);

      const addItem = (newItem) => {
        const item = {
          ...newItem,
          id: Date.now().toString(),
          createdAt: new Date().toISOString(),
        };
        setItems(prev => [item, ...prev]);
        setView('list');
      };

      const updateItem = (updatedItem) => {
        setItems(prev => prev.map(item => 
          item.id === updatedItem.id ? updatedItem : item
        ));
        setSelectedItem(updatedItem);
      };

      const deleteItem = (id) => {
        setItems(prev => prev.filter(item => item.id !== id));
        setView('list');
        setSelectedItem(null);
      };

      // Filter and sort items
      const filteredItems = items
        .filter(item => filter === 'all' || item.category === filter)
        .filter(item => {
          if (!searchQuery) return true;
          const query = searchQuery.toLowerCase();
          return (
            item.name?.toLowerCase().includes(query) ||
            item.location?.toLowerCase().includes(query) ||
            item.notes?.toLowerCase().includes(query)
          );
        })
        .sort((a, b) => {
          let comparison = 0;
          switch (sortBy) {
            case 'name':
              comparison = (a.name || '').localeCompare(b.name || '');
              break;
            case 'category':
              comparison = (a.category || '').localeCompare(b.category || '');
              break;
            case 'condition':
              comparison = CONDITIONS.indexOf(a.condition) - CONDITIONS.indexOf(b.condition);
              break;
            case 'date':
            default:
              comparison = new Date(b.createdAt) - new Date(a.createdAt);
              break;
          }
          return sortOrder === 'asc' ? comparison : -comparison;
        });

      if (isLoading) {
        return (
          <div className="min-h-screen flex items-center justify-center bg-slate-100">
            <div className="text-slate-500">Loading...</div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-slate-100 pb-20">
          {/* Header */}
          <header className="bg-slate-800 text-white px-4 py-4 sticky top-0 z-40">
            <div className="flex items-center justify-between">
              <h1 className="text-xl font-bold tracking-tight">Material Harvest</h1>
              <div className="text-sm text-slate-400">{items.length} items</div>
            </div>
          </header>

          {view === 'list' && (
            <ListView
              items={filteredItems}
              filter={filter}
              setFilter={setFilter}
              sortBy={sortBy}
              setSortBy={setSortBy}
              sortOrder={sortOrder}
              setSortOrder={setSortOrder}
              searchQuery={searchQuery}
              setSearchQuery={setSearchQuery}
              showFilterMenu={showFilterMenu}
              setShowFilterMenu={setShowFilterMenu}
              showSortMenu={showSortMenu}
              setShowSortMenu={setShowSortMenu}
              onItemClick={(item) => { setSelectedItem(item); setView('detail'); }}
              onAddClick={() => setView('add')}
            />
          )}

          {view === 'add' && (
            <AddItemView
              onSave={addItem}
              onCancel={() => setView('list')}
            />
          )}

          {view === 'detail' && selectedItem && (
            <DetailView
              item={selectedItem}
              onBack={() => { setView('list'); setSelectedItem(null); }}
              onUpdate={updateItem}
              onDelete={() => deleteItem(selectedItem.id)}
            />
          )}
        </div>
      );
    }

    // List View Component
    function ListView({ 
      items, filter, setFilter, sortBy, setSortBy, sortOrder, setSortOrder,
      searchQuery, setSearchQuery, showFilterMenu, setShowFilterMenu,
      showSortMenu, setShowSortMenu, onItemClick, onAddClick 
    }) {
      return (
        <>
          {/* Search Bar */}
          <div className="px-4 py-3 bg-white border-b border-slate-200">
            <div className="relative">
              <div className="absolute inset-y-0 left-3 flex items-center pointer-events-none text-slate-400">
                <SearchIcon />
              </div>
              <input
                type="text"
                placeholder="Search items..."
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                className="w-full pl-10 pr-4 py-2.5 bg-slate-100 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-slate-300"
              />
            </div>
          </div>

          {/* Category Pills */}
          <div className="px-4 py-3 bg-white border-b border-slate-200 overflow-x-auto hide-scrollbar">
            <div className="flex gap-2">
              <button
                onClick={() => setFilter('all')}
                className={`px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${
                  filter === 'all' 
                    ? 'bg-slate-800 text-white' 
                    : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                }`}
              >
                All
              </button>
              {CATEGORIES.map(cat => (
                <button
                  key={cat.id}
                  onClick={() => setFilter(cat.id)}
                  className={`px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors flex items-center gap-1.5 ${
                    filter === cat.id 
                      ? 'bg-slate-800 text-white' 
                      : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                  }`}
                >
                  <span>{cat.icon}</span>
                  <span>{cat.label}</span>
                </button>
              ))}
            </div>
          </div>

          {/* Sort Controls */}
          <div className="px-4 py-2 flex items-center justify-between text-sm text-slate-500">
            <span>{items.length} item{items.length !== 1 ? 's' : ''}</span>
            <div className="relative">
              <button
                onClick={() => setShowSortMenu(!showSortMenu)}
                className="flex items-center gap-1 px-2 py-1 rounded hover:bg-slate-200"
              >
                <SortIcon />
                <span className="capitalize">{sortBy}</span>
                <span className="text-xs">({sortOrder === 'asc' ? '‚Üë' : '‚Üì'})</span>
              </button>
              {showSortMenu && (
                <div className="absolute right-0 mt-1 bg-white rounded-lg shadow-lg border border-slate-200 py-1 z-50 min-w-[140px]">
                  {['date', 'name', 'category', 'condition'].map(option => (
                    <button
                      key={option}
                      onClick={() => {
                        if (sortBy === option) {
                          setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');
                        } else {
                          setSortBy(option);
                          setSortOrder('desc');
                        }
                        setShowSortMenu(false);
                      }}
                      className={`w-full px-4 py-2 text-left text-sm hover:bg-slate-100 capitalize flex justify-between ${
                        sortBy === option ? 'text-slate-900 font-medium' : 'text-slate-600'
                      }`}
                    >
                      {option}
                      {sortBy === option && <span>{sortOrder === 'asc' ? '‚Üë' : '‚Üì'}</span>}
                    </button>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* Items Grid */}
          <div className="px-4 pb-24">
            {items.length === 0 ? (
              <div className="text-center py-16 text-slate-400">
                <div className="text-5xl mb-4">üì¶</div>
                <p className="text-lg">No items yet</p>
                <p className="text-sm mt-1">Tap + to add your first item</p>
              </div>
            ) : (
              <div className="grid grid-cols-2 gap-3">
                {items.map(item => (
                  <ItemCard key={item.id} item={item} onClick={() => onItemClick(item)} />
                ))}
              </div>
            )}
          </div>

          {/* Floating Add Button */}
          <button
            onClick={onAddClick}
            className="fixed bottom-6 right-6 w-14 h-14 bg-slate-800 text-white rounded-full shadow-lg flex items-center justify-center hover:bg-slate-700 active:scale-95 transition-transform z-50"
          >
            <PlusIcon />
          </button>
        </>
      );
    }

    // Item Card Component
    function ItemCard({ item, onClick }) {
      const category = CATEGORIES.find(c => c.id === item.category) || CATEGORIES[8];
      
      return (
        <button
          onClick={onClick}
          className="bg-white rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-shadow text-left"
        >
          <div className="aspect-square bg-slate-100 relative">
            {item.image ? (
              <img src={item.image} alt={item.name} className="w-full h-full object-cover" />
            ) : (
              <div className="w-full h-full flex items-center justify-center text-4xl">
                {category.icon}
              </div>
            )}
            <div className={`absolute top-2 left-2 ${category.color} text-white text-xs px-2 py-0.5 rounded-full`}>
              {category.label}
            </div>
          </div>
          <div className="p-3">
            <h3 className="font-medium text-slate-800 truncate">{item.name || 'Unnamed'}</h3>
            <div className="flex items-center justify-between mt-1">
              <span className="text-xs text-slate-500">{item.condition}</span>
              {item.quantity > 1 && (
                <span className="text-xs bg-slate-100 px-2 py-0.5 rounded-full">√ó{item.quantity}</span>
              )}
            </div>
          </div>
        </button>
      );
    }

    // Add Item View Component
    function AddItemView({ onSave, onCancel }) {
      const [formData, setFormData] = useState({
        name: '',
        category: 'door',
        condition: 'Good',
        quantity: 1,
        width: '',
        height: '',
        depth: '',
        location: '',
        notes: '',
        image: null,
      });
      const fileInputRef = useRef(null);
      const cameraInputRef = useRef(null);

      const handleImageSelect = (e) => {
        const file = e.target.files?.[0];
        if (file) {
          const reader = new FileReader();
          reader.onloadend = () => {
            // Compress image
            const img = new Image();
            img.onload = () => {
              const canvas = document.createElement('canvas');
              const maxSize = 800;
              let { width, height } = img;
              if (width > height && width > maxSize) {
                height = (height * maxSize) / width;
                width = maxSize;
              } else if (height > maxSize) {
                width = (width * maxSize) / height;
                height = maxSize;
              }
              canvas.width = width;
              canvas.height = height;
              const ctx = canvas.getContext('2d');
              ctx.drawImage(img, 0, 0, width, height);
              setFormData(prev => ({ ...prev, image: canvas.toDataURL('image/jpeg', 0.7) }));
            };
            img.src = reader.result;
          };
          reader.readAsDataURL(file);
        }
      };

      const handleSubmit = () => {
        if (!formData.name.trim()) {
          alert('Please enter a name');
          return;
        }
        onSave(formData);
      };

      return (
        <div className="bg-white min-h-screen">
          {/* Header */}
          <div className="sticky top-0 bg-white border-b border-slate-200 px-4 py-3 flex items-center justify-between z-40">
            <button onClick={onCancel} className="text-slate-500">
              <CloseIcon />
            </button>
            <h2 className="font-semibold text-lg">Add Item</h2>
            <button
              onClick={handleSubmit}
              className="px-4 py-1.5 bg-slate-800 text-white rounded-lg text-sm font-medium"
            >
              Save
            </button>
          </div>

          <div className="p-4 space-y-5">
            {/* Image Section */}
            <div className="space-y-3">
              <label className="text-sm font-medium text-slate-700">Photo</label>
              <div className="flex gap-3">
                {formData.image ? (
                  <div className="relative w-32 h-32 rounded-xl overflow-hidden">
                    <img src={formData.image} alt="Preview" className="w-full h-full object-cover" />
                    <button
                      onClick={() => setFormData(prev => ({ ...prev, image: null }))}
                      className="absolute top-1 right-1 w-6 h-6 bg-black/50 rounded-full flex items-center justify-center text-white"
                    >
                      <CloseIcon />
                    </button>
                  </div>
                ) : (
                  <>
                    <button
                      onClick={() => cameraInputRef.current?.click()}
                      className="w-32 h-32 border-2 border-dashed border-slate-300 rounded-xl flex flex-col items-center justify-center gap-2 text-slate-400 hover:border-slate-400"
                    >
                      <CameraIcon />
                      <span className="text-xs">Camera</span>
                    </button>
                    <button
                      onClick={() => fileInputRef.current?.click()}
                      className="w-32 h-32 border-2 border-dashed border-slate-300 rounded-xl flex flex-col items-center justify-center gap-2 text-slate-400 hover:border-slate-400"
                    >
                      <ImageIcon />
                      <span className="text-xs">Gallery</span>
                    </button>
                  </>
                )}
                <input
                  ref={fileInputRef}
                  type="file"
                  accept="image/*"
                  onChange={handleImageSelect}
                  className="hidden"
                />
                <input
                  ref={cameraInputRef}
                  type="file"
                  accept="image/*"
                  capture="environment"
                  onChange={handleImageSelect}
                  className="hidden"
                />
              </div>
            </div>

            {/* Name */}
            <div>
              <label className="text-sm font-medium text-slate-700">Name *</label>
              <input
                type="text"
                value={formData.name}
                onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}
                placeholder="e.g., Victorian sash window"
                className="mt-1 w-full px-4 py-3 bg-slate-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-slate-300"
              />
            </div>

            {/* Category */}
            <div>
              <label className="text-sm font-medium text-slate-700">Category</label>
              <div className="mt-2 grid grid-cols-3 gap-2">
                {CATEGORIES.map(cat => (
                  <button
                    key={cat.id}
                    onClick={() => setFormData(prev => ({ ...prev, category: cat.id }))}
                    className={`p-3 rounded-xl border-2 flex flex-col items-center gap-1 transition-colors ${
                      formData.category === cat.id
                        ? 'border-slate-800 bg-slate-50'
                        : 'border-slate-200 hover:border-slate-300'
                    }`}
                  >
                    <span className="text-2xl">{cat.icon}</span>
                    <span className="text-xs font-medium">{cat.label}</span>
                  </button>
                ))}
              </div>
            </div>

            {/* Condition */}
            <div>
              <label className="text-sm font-medium text-slate-700">Condition</label>
              <div className="mt-2 flex gap-2">
                {CONDITIONS.map(cond => (
                  <button
                    key={cond}
                    onClick={() => setFormData(prev => ({ ...prev, condition: cond }))}
                    className={`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors ${
                      formData.condition === cond
                        ? 'bg-slate-800 text-white'
                        : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                    }`}
                  >
                    {cond}
                  </button>
                ))}
              </div>
            </div>

            {/* Quantity */}
            <div>
              <label className="text-sm font-medium text-slate-700">Quantity</label>
              <div className="mt-2 flex items-center gap-4">
                <button
                  onClick={() => setFormData(prev => ({ ...prev, quantity: Math.max(1, prev.quantity - 1) }))}
                  className="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-xl font-bold text-slate-600"
                >
                  ‚àí
                </button>
                <span className="text-2xl font-semibold w-12 text-center">{formData.quantity}</span>
                <button
                  onClick={() => setFormData(prev => ({ ...prev, quantity: prev.quantity + 1 }))}
                  className="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-xl font-bold text-slate-600"
                >
                  +
                </button>
              </div>
            </div>

            {/* Dimensions */}
            <div>
              <label className="text-sm font-medium text-slate-700">Dimensions (mm)</label>
              <div className="mt-2 grid grid-cols-3 gap-3">
                <div>
                  <input
                    type="number"
                    value={formData.width}
                    onChange={(e) => setFormData(prev => ({ ...prev, width: e.target.value }))}
                    placeholder="Width"
                    className="w-full px-3 py-2.5 bg-slate-100 rounded-xl text-center focus:outline-none focus:ring-2 focus:ring-slate-300"
                  />
                  <span className="text-xs text-slate-400 block text-center mt-1">W</span>
                </div>
                <div>
                  <input
                    type="number"
                    value={formData.height}
                    onChange={(e) => setFormData(prev => ({ ...prev, height: e.target.value }))}
                    placeholder="Height"
                    className="w-full px-3 py-2.5 bg-slate-100 rounded-xl text-center focus:outline-none focus:ring-2 focus:ring-slate-300"
                  />
                  <span className="text-xs text-slate-400 block text-center mt-1">H</span>
                </div>
                <div>
                  <input
                    type="number"
                    value={formData.depth}
                    onChange={(e) => setFormData(prev => ({ ...prev, depth: e.target.value }))}
                    placeholder="Depth"
                    className="w-full px-3 py-2.5 bg-slate-100 rounded-xl text-center focus:outline-none focus:ring-2 focus:ring-slate-300"
                  />
                  <span className="text-xs text-slate-400 block text-center mt-1">D</span>
                </div>
              </div>
            </div>

            {/* Location */}
            <div>
              <label className="text-sm font-medium text-slate-700">Source / Location</label>
              <input
                type="text"
                value={formData.location}
                onChange={(e) => setFormData(prev => ({ ...prev, location: e.target.value }))}
                placeholder="e.g., Salvo Yard, Kennington"
                className="mt-1 w-full px-4 py-3 bg-slate-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-slate-300"
              />
            </div>

            {/* Notes */}
            <div>
              <label className="text-sm font-medium text-slate-700">Notes</label>
              <textarea
                value={formData.notes}
                onChange={(e) => setFormData(prev => ({ ...prev, notes: e.target.value }))}
                placeholder="Additional details, material, age, etc."
                rows={3}
                className="mt-1 w-full px-4 py-3 bg-slate-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-slate-300 resize-none"
              />
            </div>
          </div>
        </div>
      );
    }

    // Detail View Component
    function DetailView({ item, onBack, onUpdate, onDelete }) {
      const [isEditing, setIsEditing] = useState(false);
      const [editData, setEditData] = useState(item);
      const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
      const category = CATEGORIES.find(c => c.id === item.category) || CATEGORIES[8];
      const fileInputRef = useRef(null);

      const handleSave = () => {
        onUpdate(editData);
        setIsEditing(false);
      };

      const handleImageSelect = (e) => {
        const file = e.target.files?.[0];
        if (file) {
          const reader = new FileReader();
          reader.onloadend = () => {
            const img = new Image();
            img.onload = () => {
              const canvas = document.createElement('canvas');
              const maxSize = 800;
              let { width, height } = img;
              if (width > height && width > maxSize) {
                height = (height * maxSize) / width;
                width = maxSize;
              } else if (height > maxSize) {
                width = (width * maxSize) / height;
                height = maxSize;
              }
              canvas.width = width;
              canvas.height = height;
              const ctx = canvas.getContext('2d');
              ctx.drawImage(img, 0, 0, width, height);
              setEditData(prev => ({ ...prev, image: canvas.toDataURL('image/jpeg', 0.7) }));
            };
            img.src = reader.result;
          };
          reader.readAsDataURL(file);
        }
      };

      if (isEditing) {
        return (
          <div className="bg-white min-h-screen">
            <div className="sticky top-0 bg-white border-b border-slate-200 px-4 py-3 flex items-center justify-between z-40">
              <button onClick={() => { setIsEditing(false); setEditData(item); }} className="text-slate-500">
                Cancel
              </button>
              <h2 className="font-semibold">Edit Item</h2>
              <button onClick={handleSave} className="px-4 py-1.5 bg-slate-800 text-white rounded-lg text-sm font-medium">
                Save
              </button>
            </div>
            
            <div className="p-4 space-y-4">
              {/* Image */}
              <div className="aspect-video bg-slate-100 rounded-xl overflow-hidden relative">
                {editData.image ? (
                  <img src={editData.image} alt="" className="w-full h-full object-cover" />
                ) : (
                  <div className="w-full h-full flex items-center justify-center text-6xl">{category.icon}</div>
                )}
                <button
                  onClick={() => fileInputRef.current?.click()}
                  className="absolute bottom-3 right-3 px-3 py-1.5 bg-black/50 text-white rounded-lg text-sm"
                >
                  Change Photo
                </button>
                <input ref={fileInputRef} type="file" accept="image/*" onChange={handleImageSelect} className="hidden" />
              </div>

              <input
                type="text"
                value={editData.name}
                onChange={(e) => setEditData(prev => ({ ...prev, name: e.target.value }))}
                className="w-full px-4 py-3 bg-slate-100 rounded-xl font-medium"
                placeholder="Name"
              />

              <div className="grid grid-cols-3 gap-2">
                {CATEGORIES.map(cat => (
                  <button
                    key={cat.id}
                    onClick={() => setEditData(prev => ({ ...prev, category: cat.id }))}
                    className={`p-2 rounded-lg border text-sm ${editData.category === cat.id ? 'border-slate-800 bg-slate-50' : 'border-slate-200'}`}
                  >
                    {cat.icon} {cat.label}
                  </button>
                ))}
              </div>

              <div className="flex gap-2">
                {CONDITIONS.map(cond => (
                  <button
                    key={cond}
                    onClick={() => setEditData(prev => ({ ...prev, condition: cond }))}
                    className={`flex-1 py-2 rounded-lg text-sm ${editData.condition === cond ? 'bg-slate-800 text-white' : 'bg-slate-100'}`}
                  >
                    {cond}
                  </button>
                ))}
              </div>

              <div className="grid grid-cols-3 gap-3">
                <input type="number" value={editData.width} onChange={(e) => setEditData(prev => ({ ...prev, width: e.target.value }))} placeholder="Width" className="px-3 py-2 bg-slate-100 rounded-xl text-center" />
                <input type="number" value={editData.height} onChange={(e) => setEditData(prev => ({ ...prev, height: e.target.value }))} placeholder="Height" className="px-3 py-2 bg-slate-100 rounded-xl text-center" />
                <input type="number" value={editData.depth} onChange={(e) => setEditData(prev => ({ ...prev, depth: e.target.value }))} placeholder="Depth" className="px-3 py-2 bg-slate-100 rounded-xl text-center" />
              </div>

              <input
                type="text"
                value={editData.location}
                onChange={(e) => setEditData(prev => ({ ...prev, location: e.target.value }))}
                className="w-full px-4 py-3 bg-slate-100 rounded-xl"
                placeholder="Location"
              />

              <textarea
                value={editData.notes}
                onChange={(e) => setEditData(prev => ({ ...prev, notes: e.target.value }))}
                className="w-full px-4 py-3 bg-slate-100 rounded-xl resize-none"
                rows={3}
                placeholder="Notes"
              />
            </div>
          </div>
        );
      }

      return (
        <div className="bg-white min-h-screen">
          {/* Header */}
          <div className="sticky top-0 bg-white/90 backdrop-blur border-b border-slate-200 px-4 py-3 flex items-center justify-between z-40">
            <button onClick={onBack} className="text-slate-500">
              ‚Üê Back
            </button>
            <div className="flex gap-2">
              <button onClick={() => setIsEditing(true)} className="px-4 py-1.5 bg-slate-100 rounded-lg text-sm font-medium">
                Edit
              </button>
              <button onClick={() => setShowDeleteConfirm(true)} className="p-1.5 text-red-500">
                <TrashIcon />
              </button>
            </div>
          </div>

          {/* Image */}
          <div className="aspect-video bg-slate-100 relative">
            {item.image ? (
              <img src={item.image} alt={item.name} className="w-full h-full object-cover" />
            ) : (
              <div className="w-full h-full flex items-center justify-center text-6xl">{category.icon}</div>
            )}
            <div className={`absolute bottom-4 left-4 ${category.color} text-white px-3 py-1 rounded-full text-sm font-medium`}>
              {category.icon} {category.label}
            </div>
          </div>

          {/* Details */}
          <div className="p-4 space-y-4">
            <div>
              <h1 className="text-2xl font-bold text-slate-800">{item.name}</h1>
              <p className="text-slate-500 mt-1">Added {new Date(item.createdAt).toLocaleDateString()}</p>
            </div>

            <div className="flex gap-3">
              <div className="flex-1 bg-slate-100 rounded-xl p-3 text-center">
                <div className="text-sm text-slate-500">Condition</div>
                <div className="font-semibold">{item.condition}</div>
              </div>
              <div className="flex-1 bg-slate-100 rounded-xl p-3 text-center">
                <div className="text-sm text-slate-500">Quantity</div>
                <div className="font-semibold">{item.quantity}</div>
              </div>
            </div>

            {(item.width || item.height || item.depth) && (
              <div className="bg-slate-100 rounded-xl p-4">
                <div className="text-sm text-slate-500 mb-2">Dimensions</div>
                <div className="flex gap-4 text-center">
                  {item.width && <div><span className="text-lg font-semibold">{item.width}</span><span className="text-slate-400 text-sm ml-1">W</span></div>}
                  {item.height && <div><span className="text-lg font-semibold">{item.height}</span><span className="text-slate-400 text-sm ml-1">H</span></div>}
                  {item.depth && <div><span className="text-lg font-semibold">{item.depth}</span><span className="text-slate-400 text-sm ml-1">D</span></div>}
                  <span className="text-slate-400 self-end">mm</span>
                </div>
              </div>
            )}

            {item.location && (
              <div className="bg-slate-100 rounded-xl p-4">
                <div className="text-sm text-slate-500 mb-1">Source / Location</div>
                <div className="font-medium">{item.location}</div>
              </div>
            )}

            {item.notes && (
              <div className="bg-slate-100 rounded-xl p-4">
                <div className="text-sm text-slate-500 mb-1">Notes</div>
                <div className="text-slate-700 whitespace-pre-wrap">{item.notes}</div>
              </div>
            )}
          </div>

          {/* Delete Confirmation Modal */}
          {showDeleteConfirm && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-2xl p-6 max-w-sm w-full">
                <h3 className="text-lg font-semibold mb-2">Delete Item?</h3>
                <p className="text-slate-500 mb-6">This action cannot be undone.</p>
                <div className="flex gap-3">
                  <button
                    onClick={() => setShowDeleteConfirm(false)}
                    className="flex-1 py-3 bg-slate-100 rounded-xl font-medium"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={onDelete}
                    className="flex-1 py-3 bg-red-500 text-white rounded-xl font-medium"
                  >
                    Delete
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>